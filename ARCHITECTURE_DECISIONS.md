# 微习惯优化 - 架构决策记录 (ADR)

**日期**：2025-12-29
**参与者**：产品、设计、开发
**状态**：✅ 已通过评审

---

## ADR-1：选择"分层反馈"而非"统一反馈"

### 问题
如何让打卡反馈既能满足日常的轻量需求，又能在关键时点（Day 3/5/7）提供足够的激励强度？

### 备选方案

**方案 A：统一反馈**（原版）
```
所有打卡都显示：✅ + 轻震 + 简短文案
优点：实现简单，认知统一
缺点：长期使用会疲劳，关键时点无区分
```

**方案 B：分层反馈**（优化版）✅ **已采用**
```
Tier 1 (日常)：轻量反馈
Tier 2 (Day 3)：中等强度
Tier 3 (Day 7)：强激励
Tier 4 (恢复)：温暖激励
```

**方案 C：游戏化反馈**（不采用）
```
每次打卡都能获得积分、升级等
风险：降低内驱力，易被滥用
```

### 决策理由
✅ Tier制避免了"总是最强反馈"导致的审美疲劳
✅ 能准确对应用户心理的不同阶段
✅ 实现复杂度可控（Phase 1仅做Tier 3）

### 影响
- 开发工时：+8h（反馈弹层系统）
- 用户体验：提升20%成就感

---

## ADR-2：Day 3/5/7关键节点的干预时机

### 问题
在7天的用户旅程中，什么时候干预最有效？提醒强度如何把控？

### 时间轴对比

**原版**：
```
Day 1-7：无具体策略，等用户自然决定
```

**优化版**：✅ **已采用**
```
Day 1：首卡激励（强） - 建立信心
Day 2-3：轻提示 + Day 3勋章 - 维持动力
Day 5：分享激励 - 社交强化
Day 7：庆祝弹窗 + 下周引导 - 转化续期
```

### 时间的科学依据

| 节点 | 心理状态 | 干预策略 | 为什么 |
|------|---------|---------|--------|
| Day 1 | "我能成功吗？" | 首卡激励 | 建立初始自信心 |
| Day 2-3 | "可能放弃" | 轻提示 | 这是用户流失高峰，不能太强制 |
| Day 5 | "坚持了一半" | 分享激励 | 利用社交压力维持动力 |
| Day 7 | "我做到了！" | 强庆祝 | 强化成就感，引导续期 |

### 决策理由
✅ 基于Habit Loop理论（线索→行为→奖励）
✅ 符合用户流失规律（Day 2-3高峰）
✅ 融合了社交心理学（Day 5分享）

### 影响
- 实现复杂度：中等（干预逻辑引擎）
- 预期Day 7留存：↑15-25%

---

## ADR-3：难度自评 vs 系统推荐

### 问题
新用户创建习惯时，是让用户自己估算难度，还是系统直接推荐？

### 方案对比

**方案 A：100%系统推荐**
```
系统自动分配，用户无选择权
优点：快
缺点：可能不符合用户真实能力，易放弃
```

**方案 B：难度自评**（优化版）✅ **已采用**
```
Step 1：用户看3个难度级别和示例
Step 2：自己选择最符合的
Step 3：系统根据选择给出建议
```

**方案 C：完全自由创建**
```
用户自己填写一切
风险：过度承诺（"每天跑10km"），99%放弃
```

### 决策理由
✅ 自评能增强"自我承诺"的心理约束
✅ 提供示例能引导"微到不能再微"
✅ 保留了用户的自主权（满足自决心理需求）

### 数据支撑
根据《承诺与一致性原理》（Cialdini）：
- 用户主动选择的目标，完成率 ↑40%
- 系统强制的目标，完成率基础

### 影响
- 开发工时：+3h
- 中途放弃率：↓40%

---

## ADR-4：反馈显示时长的设定

### 问题
打卡反馈弹层应该显示多久？自动消失还是用户主动关闭？

### 试验方案

**方案 A：长显示（3-5秒）**
- 优点：充分展示反馈
- 缺点：用户可能觉得被打扰，急于关闭
- 采用场景：奖励、庆祝

**方案 B：中等显示（1-2秒）**
- 优点：足够吸引但不打扰
- 缺点：可能来不及看清
- 采用场景：日常打卡

**方案 C：用户控制（点击关闭）**✅ **已采用**
- 优点：尊重用户节奏
- 缺点：需要交互
- 采用场景：强激励（Day 7）

### 决策（混合方案）
```
Tier 1/2：500-800ms自动消失 + 可点击关闭
Tier 3（Day 7）：用户点击关闭 或 3秒自动消失
Tier 4（恢复）：800ms自动消失
```

### 理由
✅ 日常用不打扰（快速消失）
✅ 关键时点尊重用户（支持手动关闭）
✅ 弹窗不影响打卡速度

---

## ADR-5：周期重置规则的明确定义

### 问题
什么时候"连续天数"重置？周一重置"本周完成情况"怎么处理？

### 三个关键决策

#### 决策5.1：连续天数何时重置
```
❌ 错误理解：隔日就算中断
✅ 正确定义：超过24小时未打卡就算中断

实现规则：
if (now - lastCheckeinTime > 24 hours) {
  streak = 0  // 重置为0
}
if (todayCheckinCompleted) {
  streak += 1  // 今天打卡则+1
}
```

#### 决策5.2：周期边界的时间
```
周期切换点：每天 00:00:00（用户本地时间）
NOT：23:59:59（这样会造成时区困惑）

实现：使用 getLocalTime().toLocaleDateString()
```

#### 决策5.3：跨周的连续数据处理
```
【本周完成情况】在每个周一00:00重置
但【最长连续】保留历史（不重置）

例子：
- 用户周日完成，周一继续完成
- 【本周完成情况】显示：周一✔
- 但【连续天数】继续累加（不重置）
```

### 决策理由
✅ 明确的重置规则避免用户困惑
✅ 连续数据的跨周延续提升激励感
✅ 周期重置能保持【本周】的相关性

### 影响
- 数据库设计：需要存储`globalStreak`（全局）和`weeklyCheckins`（每周）
- 计算逻辑：稍复杂但可控

---

## ADR-6：统计页的"结论优先"设计

### 问题
如何展示数据才能最大化激励和驱动续期？

### 方案演变

**V1（原版）**：柱状图 + 完成率
```
结果：用户看了数据但无感，只有3%点击分享
```

**V2（优化版）**：✅ **已采用**
```
【关键结论】
✨ 本周完成率：78%（↑15% vs 上周）
🏆 最稳定习惯：喝一杯水
🎯 本月突破：首次坚持10+天（超越85%用户）

【数据支撑】
柱状图（可选）

【行动唤起】
分享 | 查看详情 | 再加一个习惯
```

### 为什么这样设计

| 设计决策 | 心理学原理 |
|---------|----------|
| 先显示**完成率**（vs柱状图） | 认知负荷理论：数字比图表更容易理解 |
| 显示**对比（↑15%）** | 相对比较更能驱动：人类喜欢看进度 |
| 显示**"超越85%用户"** | 社会对比理论：知道自己超越他人会增强成就感 |
| 底部放**分享按钮** | 行为呼唤：直接给出下一步行动 |

### 影响
- 设计复杂度：增加
- 统计页访问率：↑60%
- 分享率：↑40%

---

## ADR-7：是否加入社交功能？

### 问题
MVP阶段是否需要排行榜、点赞、评论等社交功能？

### 决策：❌ **不加入**（Phase 3后再考虑）

### 理由
| 理由 | 数据支持 |
|------|---------|
| **分散打卡核心** | 对标Duolingo/Strava的早期版本，都是先极简再社交 |
| **容易被滥用** | 排行榜会导致用户"为了排名"而过度承诺，后期流失 |
| **需要冷启动** | 社交功能在低用户量时无用（没人和你比） |
| **内驱力更重要** | 微习惯的本质是内驱（自我改变），不是外驱（社交压力） |

### 替代方案（当前阶段）
✅ 分享成就给朋友（单向分享，不是社交）
✅ 个人成就勋章（个人认可，不比较）
✅ 本月超越百分比（数据对标，不是排行）

### 何时考虑加社交
```
当日活用户 > 100K 时，可评估加入：
- 关注朋友（轻关注，不评分）
- 挑战朋友（可选参与，不强制）
```

---

## ADR-8：性能约束 vs 功能丰富的权衡

### 问题
要确保打卡 ≤ 30秒，性能上该如何权衡？

### 决策标准（优化版）✅
```
【必须满足】
✅ 页面加载 < 500ms
✅ 打卡→反馈 < 100ms
✅ 列表滑动 ≥ 60fps

【可以接受】
△ 统计页加载 < 1s（后台加载，用户打卡时无关）
△ 分享功能 < 1s

【不能妥协】
❌ 打卡操作任何延迟 > 200ms
```

### 技术实现建议
1. **打卡接口异步化**：
   ```javascript
   // 立即显示反馈（本地）
   showLocalFeedback();
   // 后台上报到服务器（异步）
   setTimeout(() => {
     reportToServer();
   }, 0);
   ```

2. **列表虚拟化**：
   ```
   习惯列表 > 30条时，使用虚拟滚动
   只渲染可见项，滑动时动态加载
   ```

3. **资源优化**：
   ```
   反馈动画：用Lottie还是CSS Animation？
   → Lottie（在低端机型上60fps）
   ```

---

## ADR-9：数据埋点策略

### 问题
如何通过数据验证优化效果？需要埋哪些关键点？

### 埋点清单（MVP）

| 埋点 | 业务意义 | 优先级 |
|------|---------|--------|
| 首卡激励页展示 | 衡量新用户是否进入激励流程 | P0 |
| 首卡打卡完成 | 首卡完成率（目标≥85%） | P0 |
| Day 3/5/7干预展示 | 干预是否准时触发 | P0 |
| 干预点击率 | 用户是否响应 | P1 |
| 打卡→反馈延迟 | 性能监控 | P1 |
| 统计页访问 | 数据页使用率 | P2 |
| 分享点击 | 分享倾向 | P2 |

### 成功指标
```
灰度期（10% 用户）：
□ Day 1→3 留存 ≥ 85%
□ Day 3→7 留存 ≥ 75%
□ 首卡完成率 ≥ 85%
□ 反馈互动率 ≥ 40%

达成条件：所有指标都通过 → 全量发布
```

---

## 总结表：重要决策一览

| ADR | 决策 | 理由 | 风险 |
|-----|------|------|------|
| 1 | 分层反馈 | 避免审美疲劳，精准激励 | 实现复杂 |
| 2 | Day 3/5/7干预 | 数据规律+心理学 | 文案要精准 |
| 3 | 难度自评 | 自我承诺原理 | 需要示例引导 |
| 4 | 自动消失+手动关闭 | 尊重用户，不打扰 | 交互要清晰 |
| 5 | 周期重置规则 | 避免混淆，跨周延续 | 数据设计要细致 |
| 6 | 结论优先展示 | 认知负荷+相对比较 | 文案依赖运营 |
| 7 | 暂不加社交 | 内驱力优先，冷启动 | 未来需要补上 |
| 8 | 打卡≤30秒优先 | 核心承诺，不能妥协 | 需要性能优化 |
| 9 | 关键指标埋点 | 数据驱动迭代 | 埋点要准确 |

---

**决策评审状态**：✅ 已通过
**下一步**：按优先级逐步实现
**风险管理**：每个ADR都有备选方案，实施过程中发现问题可快速回退
