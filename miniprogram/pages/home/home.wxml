<!-- å¾®ä¿¡å°ç¨‹åºç‰ˆé¦–é¡µ -->
<view class="container">
  <!-- ä¸»æ ‡é¢˜åŒºåŸŸ -->
  <view class="hero-section">
    <view class="hero-title">ä»Šå¤©ï¼Œä»å°å¼€å§‹</view>
    <view class="hero-subtitle">æ¯ä¸€ä¸ªå¾®å°è¡ŒåŠ¨ï¼Œéƒ½æ˜¯ä¼Ÿå¤§æ”¹å˜çš„å¼€å§‹</view>
  </view>

  <!-- æ¿€åŠ±åŒºåŸŸ -->
  <view class="encouragement-section" wx:if="{{!loading && !loadError && habits.length > 0}}">
    <view class="encouragement-card">
      <view class="encouragement-icon">ğŸ’ª</view>
      <view class="encouragement-text">{{encouragementText}}</view>
      <view class="encouragement-progress">å·²å®Œæˆ {{completedCount}}/{{totalCount}}</view>
      <view class="encouragement-bar">
        <view class="encouragement-fill" style="width: {{progress}}%"></view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="spinner"></view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- åŠ è½½å¤±è´¥ -->
  <view class="error-state" wx:elif="{{loadError}}">
    <view class="error-icon">ğŸ˜´</view>
    <view class="error-title">æš‚æ—¶æ— æ³•åŠ è½½</view>
    <view class="error-text">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</view>
    <button class="btn btn-primary" bindtap="retryLoadTodayHabits">é‡æ–°åŠ è½½</button>
  </view>

  <!-- ä¹ æƒ¯åˆ—è¡¨ -->
  <view class="habits-list" wx:elif="{{habits.length > 0}}">
    <view class="habit-card"
          wx:for="{{habits}}"
          wx:key="_id"
          bindlongpress="showHabitMenu"
          data-id="{{item._id}}">

      <!-- å·¦ä¾§å®ŒæˆçŠ¶æ€ -->
      <view class="habit-check" bindtap="handleCheckIn" data-id="{{item._id}}" data-completed="{{item.is_completed}}">
        <view class="check-circle {{item.is_completed ? 'checked' : ''}}">
          <text wx:if="{{item.is_completed}}" class="check-text">âœ“</text>
        </view>
      </view>

      <!-- ä¹ æƒ¯ä¿¡æ¯ -->
      <view class="habit-content">
        <view class="habit-name">{{item.name}}</view>
        <view class="habit-progress">{{item.today_times}}/{{item.target_times_per_day}} {{item.unit || 'æ¬¡'}}</view>

        <!-- è¿›åº¦æ¡ -->
        <view class="progress-bar">
          <view class="progress-fill {{item.is_completed ? 'completed' : ''}}"
                style="width: {{item.progressPercent}}%"></view>
        </view>

        <!-- æ ‡ç­¾å’Œå®Œæˆç‡ -->
        <view class="habit-meta">
          <view class="habit-tags">
            <view class="tag tag-trigger">{{item.trigger}}</view>
            <view class="tag tag-category">æ¯æ—¥</view>
          </view>
          <view class="habit-completion {{item.is_completed ? 'completed' : ''}}">
            {{item.is_completed ? 'å·²å®Œæˆ' : (item.progressPercent + '%')}}
          </view>
        </view>
      </view>

      <!-- å®ŒæˆçŠ¶æ€æ ‡è®° -->
      <view class="completion-badge" wx:if="{{item.is_completed}}">
        <text class="badge-text">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <view class="empty-icon">ğŸ¯</view>
    <view class="empty-title">ä»Šå¤©è¿˜æ²¡æœ‰è¦åšçš„å¾®ä¹ æƒ¯</view>
    <view class="empty-text">ä»ä¸€ä¸ªå°åŠ¨ä½œå¼€å§‹å§</view>
    <button class="btn btn-primary" bindtap="goToHabits">å»ä¹ æƒ¯åº“çœ‹çœ‹</button>
  </view>

  <!-- æ‰“å¡æˆåŠŸæç¤º -->
  <view class="toast {{showEmotionFeedback ? 'show' : ''}}" wx:if="{{showEmotionFeedback}}">
    <view class="toast-text">{{emotionFeedbackText}}</view>
  </view>

  <!-- åº•éƒ¨æ‚¬æµ®æŒ‰é’® -->
  <view class="fab" bindtap="goToCreate">
    <text class="fab-text">+</text>
  </view>
</view>

