<!-- 数据导出页面 -->
<view class="container">
  <view class="page-content">
    <!-- 标题 -->
    <view class="header">
      <text class="title">📊 数据导出</text>
      <text class="subtitle">备份你的所有习惯数据</text>
    </view>

    <!-- 未导出状态 -->
    <view class="content" wx:if="{{!exported}}">
      <view class="info-box">
        <text class="info-title">🔒 隐私保护</text>
        <text class="info-text">你的数据完全属于你。导出功能让你可以随时备份或转移数据。</text>
      </view>

      <view class="action-section">
        <button class="btn btn-primary" bindtap="generateExport" disabled="{{loading}}">
          {{loading ? '生成中...' : '📥 生成导出数据'}}
        </button>
      </view>

      <view class="tips">
        <text class="tips-title">说明:</text>
        <text class="tips-text">• 包含所有习惯的完整信息</text>
        <text class="tips-text">• 包含每个习惯的进度和统计</text>
        <text class="tips-text">• 支持 JSON 和 CSV 两种格式</text>
        <text class="tips-text">• 任何时间可以重新导出</text>
      </view>
    </view>

    <!-- 已导出状态 -->
    <view class="content" wx:else>
      <!-- 导出统计 -->
      <view class="export-stats">
        <view class="stat-item">
          <text class="stat-icon">📋</text>
          <view class="stat-content">
            <text class="stat-label">导出习惯数</text>
            <text class="stat-value">{{exportData.total_habits}} 个</text>
          </view>
        </view>
        <view class="stat-item">
          <text class="stat-icon">📅</text>
          <view class="stat-content">
            <text class="stat-label">导出时间</text>
            <text class="stat-value">{{exportData.json.export_time}}</text>
          </view>
        </view>
      </view>

      <!-- 格式选择 -->
      <view class="format-section">
        <text class="section-title">选择导出格式</text>
        <view class="format-options">
          <radio-group bindchange="handleFormatChange" value="{{exportFormat}}">
            <view class="radio-item">
              <radio value="json" />
              <text class="radio-label">JSON 格式 (完整数据)</text>
            </view>
            <view class="radio-item">
              <radio value="csv" />
              <text class="radio-label">CSV 格式 (表格)</text>
            </view>
          </radio-group>
        </view>
      </view>

      <!-- 数据预览 -->
      <view class="preview-section">
        <text class="section-title">数据预览 (前500字)</text>
        <view class="data-preview">
          <text class="preview-text">{{exportFormat === 'json'
            ? JSON.stringify(exportData.json, null, 2).substring(0, 500) + '...'
            : exportData.csv.substring(0, 500) + '...'}}</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-section">
        <button class="btn btn-primary" bindtap="copyData">
          📋 复制到剪贴板
        </button>
        <button class="btn btn-secondary" bindtap="downloadData">
          ⬇️ 下载数据文件
        </button>
        <button class="btn btn-outline" bindtap="generateExport">
          🔄 重新生成
        </button>
      </view>

      <view class="tips">
        <text class="tips-title">导出完成 ✅</text>
        <text class="tips-text">• 你可以将数据保存在电脑上</text>
        <text class="tips-text">• 数据格式可被通用工具打开</text>
        <text class="tips-text">• 支持数据导入和迁移</text>
      </view>
    </view>
  </view>
</view>
