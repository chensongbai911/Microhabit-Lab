<!-- æ–°å»º/ç¼–è¾‘ä¹ æƒ¯é¡µ -->
<view class="container">
  <view class="page-container">
    <!-- æ ‡é¢˜å’Œæç¤º -->
    <view class="header">
      <view class="title">{{pageTitle}}</view>
      <!-- Phase 1æ”¹è¿›: ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯ -->
      <view class="subtitle" wx:if="{{mode === 'create'}}">å†™ä¸‹ä¸€ä¸ª30ç§’å†…èƒ½å®Œæˆçš„å°åŠ¨ä½œ</view>
      <view class="habit-status" wx:else>
        <view class="status-item">
          <text class="status-label">å·²è¿›è¡Œ</text>
          <text class="status-value">{{habitStatus.currentDay}}/{{habitStatus.totalDays}}å¤©</text>
        </view>
        <view class="status-item">
          <text class="status-label">å®Œæˆç‡</text>
          <text class="status-value">{{habitStatus.completionRate}}%</text>
        </view>
        <view class="status-item">
          <text class="status-label">æœ€åå®Œæˆ</text>
          <text class="status-value">{{habitStatus.lastCompletedAt}}</text>
        </view>
      </view>
    </view>

    <!-- è¡¨å• -->
    <view class="form">
      <!-- ä¹ æƒ¯åç§° -->
      <view class="form-item">
        <view class="form-label">ä¹ æƒ¯åç§°</view>
        <input class="form-input"
               placeholder="ä¾‹: åˆ·ç‰™åå–ä¸€å£æ°´ / ç¡å‰å†™1å¥è¯æ—¥è®°"
               value="{{formData.name}}"
               maxlength="30"
               bindinput="handleNameInput" />
        <view class="form-hint">
          <text class="text-tertiary">ä¸è¦å†™æˆ"æ¯å¤©è·‘æ­¥5å…¬é‡Œ",å…ˆä»"ç©¿ä¸Šè·‘é‹èµ°å‡ºé—¨100ç±³"å¼€å§‹</text>
          <view class="form-feedback">
            <text class="char-count">{{nameLength}}/30</text>
            <text class="feedback-status" wx:if="{{nameFeedback}}">{{nameFeedback}}</text>
          </view>
        </view>
        <!-- æ¨èæç¤º -->
        <view class="recommendation-hint" wx:if="{{formData.name.length > 0}}">
          <text class="hint-icon">ğŸ’¡</text>
          <text class="hint-text">æ¨è <strong>{{triggerCategories[selectedTriggerCategory].label}}</strong> æ—¶é—´æ®µçš„è§¦å‘å™¨</text>
        </view>
      </view>

      <!-- è§¦å‘å™¨åˆ†ç±»é€‰æ‹© -->
      <view class="form-item">
        <!-- P1-2: ä¼˜åŒ–è§¦å‘æ—¶é—´æ ‡é¢˜ -->
        <view class="form-label">ä»€ä¹ˆæ—¶å€™åšæœ€è½»æ¾ï¼Ÿ</view>
        <view class="form-sublabel">å…ˆé€‰ä¸€ä¸ªä¸å®¹æ˜“å¿˜çš„æ—¶é—´ç‚¹</view>
        <view class="trigger-info-box">
          <text class="info-icon">â„¹ï¸</text>
          <text class="info-text">é€‰æ‹©ä½ å·²æœ‰çš„æ—¥å¸¸æ´»åŠ¨ä½œä¸ºè§¦å‘ç‚¹ï¼Œæ¯”å¦‚"åˆ·ç‰™å"ã€"åˆé¤æ—¶"ä¼šæ¯”"æœ‰ç©ºæ—¶"æ›´å®¹æ˜“åšæŒ</text>
        </view>
        <view class="trigger-categories">
          <view wx:for="{{allCategories}}"
                wx:key="key"
                class="category-tag {{selectedTriggerCategory === item.key ? 'active' : ''}}"
                data-category="{{item.key}}"
                bindtap="handleTriggerCategorySelect">
            <text class="category-icon">{{item.icon}}</text>
            <text class="category-name">{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- è§¦å‘å™¨åˆ—è¡¨ -->
      <view class="form-item">
        <view class="trigger-list">
          <view wx:for="{{recommendedTriggers}}"
                wx:key="value"
                class="trigger-option {{formData.trigger === item.value ? 'selected' : ''}}"
                data-value="{{item.value}}"
                bindtap="handleTriggerSelect">
            <text class="trigger-icon">{{item.icon}}</text>
            <view class="trigger-info">
              <text class="trigger-label">{{item.label}}</text>
              <text class="trigger-time">{{item.time}}</text>
            </view>
            <!-- å®Œæˆç‡æ•°æ®æ˜¾ç¤º -->
            <view class="trigger-stats" wx:if="{{item.completionRate > 0}}">
              <text class="stat-completion">{{item.completionRate}}%</text>
              <text class="stat-label">å®Œæˆç‡</text>
            </view>
            <text class="trigger-checkmark" wx:if="{{formData.trigger === item.value}}">âœ“</text>
          </view>
        </view>

        <!-- è‡ªå®šä¹‰è§¦å‘å™¨è¾“å…¥ -->
        <view class="custom-trigger" wx:if="{{formData.trigger === 'other'}}">
          <view class="custom-trigger-hint">
            <text class="hint-icon">ğŸ’¡</text>
            <text class="hint-text">ä¾‹å¦‚ï¼šåˆ·ç‰™åã€åˆé¤å‰ã€ä¸ŠåºŠå‰</text>
          </view>
          <input class="form-input"
                 placeholder="è¾“å…¥è‡ªå®šä¹‰è§¦å‘å™¨ï¼ˆå¦‚ï¼šåˆ·ç‰™åï¼‰"
                 value="{{formData.customTrigger}}"
                 bindinput="handleCustomTriggerInput"
                 maxlength="20" />
        </view>
      </view>

      <!-- æé†’æ—¶é—´é¢„è§ˆ -->
      <view class="form-item" wx:if="{{formData.trigger}}">
        <view class="reminder-preview">
          <view class="reminder-icon">ğŸ””</view>
          <view class="reminder-info">
            <text class="reminder-label">ç³»ç»Ÿä¼šåœ¨</text>
            <text class="reminder-time">{{reminderTime}}</text>
            <text class="reminder-label">æé†’ä½ </text>
          </view>
          <view class="reminder-tip">
            <text class="tip-text">åŸºäº"{{formData.trigger === 'other' ? formData.customTrigger : formData.trigger}}"è‡ªåŠ¨å®‰æ’</text>
          </view>
        </view>
      </view>

      <!-- æ‰§è¡Œé¢‘æ¬¡ -->
      <view class="form-item">
        <view class="form-label">æ¯å¤©æ‰§è¡Œå‡ æ¬¡?</view>
        <view class="frequency-options">
          <view wx:for="{{frequencyOptions}}"
                wx:key="*this"
                class="frequency-btn {{formData.target_times_per_day === item ? 'active' : ''}}"
                bindtap="handleFrequencySelect"
                data-value="{{item}}">
            <view class="frequency-main">æ¯å¤©{{item}}æ¬¡</view>
            <!-- P0-1: å¼ºåŒ–æ¯å¤©1æ¬¡=æœ€ä¼˜ -->
            <view class="frequency-sub" wx:if="{{item === 1}}">ï¼ˆæœ€å®¹æ˜“åšæŒï¼‰</view>
          </view>
        </view>

        <!-- P0-1: æ·»åŠ è­¦å‘Šæ–‡æ¡ˆ -->
        <view class="frequency-warning" wx:if="{{formData.target_times_per_day > 1}}">
          <text class="warning-icon">âš ï¸</text>
          <text class="warning-text">æ¬¡æ•°è¶Šå¤šï¼Œè¶Šå®¹æ˜“æ”¾å¼ƒ</text>
        </view>

        <!-- å®Œæˆç‡é¢„æµ‹ -->
        <view class="frequency-impact">
          <!-- P1-1: é¢„æœŸå®Œæˆç‡æ–‡æ¡ˆé‡å†™ -->
          <view class="impact-item">
            <text class="impact-label-new">{{completionRateText}}</text>
          </view>
          <text class="impact-tips">{{frequencyImpactTips}}</text>
        </view>

        <!-- å½±å“åˆ†æè­¦å‘Š (ç¼–è¾‘æ¨¡å¼) -->
        <view class="impact-analysis" wx:if="{{impactAnalysis.show}}" style="border-left: 4px solid {{impactAnalysis.color}};">
          <view class="impact-header">
            <text class="impact-severity {{impactAnalysis.severity}}">
              {{impactAnalysis.severity === 'info' ? 'â„¹ï¸' : impactAnalysis.severity === 'warning' ? 'âš ï¸' : 'âŒ'}}
              {{impactAnalysis.severity === 'info' ? 'æç¤º' : impactAnalysis.severity === 'warning' ? 'è­¦å‘Š' : 'é£é™©'}}
            </text>
          </view>
          <text class="impact-message">{{impactAnalysis.message}}</text>
          <view class="impact-list" wx:if="{{impactAnalysis.impacts.length > 0}}">
            <view class="impact-item-small" wx:for="{{impactAnalysis.impacts}}" wx:key="index">
              <text class="impact-bullet">â€¢</text>
              <text class="impact-detail">{{item}}</text>
            </view>
          </view>
          <text class="impact-recommendation" wx:if="{{impactAnalysis.recommendation}}">ğŸ’¡ {{impactAnalysis.recommendation}}</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="footer-actions">
      <button class="btn btn-outline" bindtap="handleCancel">å–æ¶ˆ</button>
      <!-- P0-2: åˆ›å»ºæŒ‰é’®å»æ‰¿è¯ºåŒ– -->
      <button class="btn btn-primary" bindtap="handleSubmit" disabled="{{!canSubmit}}">
        {{mode === 'edit' ? 'ä¿å­˜' : 'ä»ä»Šå¤©è¯•è¯•'}}
      </button>
    </view>

    <!-- P0-2: æ·»åŠ åº•éƒ¨å®‰æŠšè¯´æ˜ -->
    <view class="footer-hint" wx:if="{{mode === 'create'}}">
      <text class="hint-text">éšæ—¶å¯ä»¥æ”¹ï¼Œä¸ä¼šæ¸…é›¶</text>
    </view>
  </view>
</view>
