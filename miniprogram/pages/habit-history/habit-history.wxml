<!-- ä¹ æƒ¯å˜æ›´å†å²é¡µé¢ -->
<view class="container">
  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{emptyState && !loading}}">
    <view class="empty-icon">ğŸ“</view>
    <view class="empty-text">æš‚æ— å˜æ›´è®°å½•</view>
    <view class="empty-hint">è¿˜æ²¡æœ‰å¯¹æ­¤ä¹ æƒ¯è¿›è¡Œä»»ä½•ä¿®æ”¹</view>
  </view>

  <!-- å˜æ›´åˆ—è¡¨ -->
  <view class="change-list" wx:else>
    <view class="timeline">
      <view class="change-item" wx:for="{{changeLogs}}" wx:key="{{item._id}}" bindtap="toggleExpand" data-index="{{index}}">
        <!-- æ—¶é—´çº¿ç‚¹ -->
        <view class="timeline-dot {{item.isUndo ? 'undo' : 'field'}}">
          <text>{{item.isUndo ? 'â†©ï¸' : 'âœï¸'}}</text>
        </view>

        <!-- å¡ç‰‡å†…å®¹ -->
        <view class="timeline-card">
          <!-- ç®€è¦ä¿¡æ¯ -->
          <view class="change-header">
            <text class="field-name">{{item.fieldLabel}}</text>
            <text class="change-time">{{item.time}}</text>
          </view>

          <!-- å€¼å˜åŒ–ç®€è§ˆ -->
          <view class="value-preview" wx:if="{{!expanded[index]}}">
            <text class="value-old">{{item.old_value}}</text>
            <text class="arrow">â†’</text>
            <text class="value-new">{{item.new_value}}</text>
          </view>

          <!-- è¯¦ç»†å†…å®¹ (å±•å¼€æ—¶) -->
          <view class="details" wx:if="{{expanded[index]}}">
            <view class="detail-row">
              <text class="label">ä¿®æ”¹å‰:</text>
              <text class="value">{{item.old_value}}</text>
            </view>
            <view class="detail-row">
              <text class="label">ä¿®æ”¹å:</text>
              <text class="value">{{item.new_value}}</text>
            </view>

            <!-- æ¢å¤æŒ‰é’® (ä»…åœ¨éæ’¤é”€æ“ä½œæ—¶æ˜¾ç¤º) -->
            <view class="action-buttons" wx:if="{{!item.isUndo}}">
              <button class="btn-restore" bindtap="restoreChange" data-index="{{index}}">
                â†©ï¸ æ¢å¤åˆ°æ­¤çŠ¶æ€
              </button>
            </view>
          </view>

          <!-- å±•å¼€æŒ‡ç¤º -->
          <view class="expand-indicator">
            <text class="icon {{expanded[index] ? 'expanded' : ''}}">{{expanded[index] ? 'â–²' : 'â–¼'}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
