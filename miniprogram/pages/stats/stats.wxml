<!-- æ•°æ®&æˆ‘é¡µ - Day 6 ç»“è®ºä¼˜å…ˆ + å¯è§†åŒ–å¢å¼º -->
<view class="container">
  <view class="page-container">
    <!-- ä¸»ç»“è®ºå¡ç‰‡ -->
    <view class="conclusion-card">
      <!-- å¤§æ ‡é¢˜ï¼šæœ¬å‘¨å®Œæˆç‡ -->
      <view class="conclusion-header">
        <view class="rate-emoji">{{improved ? 'ğŸ“ˆ' : 'ğŸ“Š'}}</view>
        <view class="rate-main">
          <view class="rate-value">{{weeklyRate}}%</view>
          <view class="rate-label">æœ¬å‘¨å®Œæˆç‡</view>
        </view>
      </view>

      <!-- æœ€å¥½çš„ä¹ æƒ¯ -->
      <view class="best-habit-section">
        <view class="section-label">æœ€å¥½çš„ä¹ æƒ¯</view>
        <view class="best-habit-name">{{bestHabit}}</view>
      </view>

      <!-- æ”¹è¿›æŒ‡æ ‡ -->
      <view class="improvement-section" wx:if="{{improved}}">
        <view class="improvement-tag">ğŸ’ª æ¯”ä¸Šå‘¨è¿›æ­¥ {{improvementPercent}}%</view>
      </view>

      <!-- å»ºè®®æ–‡æ¡ˆ -->
      <view class="advice-box">
        <view class="advice-text">{{advice}}</view>
      </view>
    </view>

    <!-- ğŸ“ˆ 7å¤©å®Œæˆç‡è¶‹åŠ¿ -->
    <view class="chart-card">
      <view class="chart-title">ğŸ“ˆ æœ¬å‘¨å®Œæˆç‡è¶‹åŠ¿</view>
      <view class="chart-container">
        <view class="chart-bars">
          <view class="bar-item" wx:for="{{weeklyBars}}" wx:key="index">
            <view class="bar-bar" style="height: {{item.height}}rpx;"></view>
            <view class="bar-label">{{weekDays[index]}}</view>
            <view class="bar-value">{{item.rate}}%</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ğŸ† æœ¬å‘¨æœ€ä½³ä¹ æƒ¯æ’è¡Œ -->
    <view class="ranking-card">
      <view class="ranking-title">ğŸ† å®Œæˆç‡æ’è¡Œ</view>
      <view class="ranking-list" wx:if="{{topHabits.length > 0}}">
        <view class="ranking-item" wx:for="{{topHabits}}" wx:key="name">
          <view class="medal-emoji">{{item.medal}}</view>
          <view class="ranking-content">
            <view class="ranking-name">{{item.name}}</view>
            <view class="ranking-rate">{{item.completion_rate || 0}}% å®Œæˆç‡</view>
          </view>
          <view class="ranking-badge">Top {{item.rank}}</view>
        </view>
      </view>
      <view class="ranking-empty" wx:if="{{topHabits.length === 0}}">
        <view class="ranking-empty-icon">ğŸ“Š</view>
        <view class="ranking-empty-text">æš‚æ— ä¹ æƒ¯æ•°æ®ï¼Œå¼€å§‹åˆ›å»ºå§ï¼</view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ®æ¦‚è§ˆ -->
    <view class="stats-cards">
      <view class="stat-card">
        <view class="stat-value">{{stats.totalHabits}}</view>
        <view class="stat-label">æ€»ä¹ æƒ¯æ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-value">{{stats.maxStreak}}</view>
        <view class="stat-label">æœ€é•¿åšæŒ</view>
      </view>
      <view class="stat-card">
        <view class="stat-value">{{stats.inProgress}}</view>
        <view class="stat-label">è¿›è¡Œä¸­</view>
      </view>
    </view>

    <!-- è®¢é˜…æ¶ˆæ¯æµ‹è¯• -->
    <view class="subscribe-card">
      <view class="subscribe-title">ğŸ“¨ ä¸“æ³¨ä¹ æƒ¯å®Œæˆé€šçŸ¥</view>
      <view class="subscribe-desc">ç‚¹å‡»å…ˆæˆæƒï¼Œå†å‘é€ä¸€æ¡æµ‹è¯•æ¶ˆæ¯åˆ°å¾®ä¿¡</view>
      <view class="subscribe-actions">
        <button class="sub-btn" size="mini" bindtap="handleSubscribe">æˆæƒè®¢é˜…</button>
        <button class="sub-btn primary" size="mini" bindtap="handleSendTest">å‘é€æµ‹è¯•</button>
      </view>
    </view>

    <!-- é”™è¯¯æç¤º + åˆ·æ–° -->
    <view class="stats-error" wx:if="{{statsError}}">
      <text>{{statsError}}</text>
      <button class="refresh-btn" size="mini" bindtap="handleRefreshTap">åˆ·æ–°</button>
    </view>
    <view class="stats-error" wx:elif="{{!statsError}}">
      <button class="refresh-btn" size="mini" bindtap="handleRefreshTap">åˆ·æ–°</button>
    </view>

    <!-- ä¼šå‘˜æ¨¡å— -->
    <view class="member-card" bindtap="goToMembership">
      <view class="member-title">{{memberInfo.title}}</view>
      <view class="member-desc">{{memberInfo.desc}}</view>
      <view class="member-action" wx:if="{{!memberInfo.isMember}}">å¼€é€šä¼šå‘˜ â†’</view>
    </view>

    <!-- è®¾ç½®å…¥å£ -->
    <view class="settings-list">
      <view class="setting-item" bindtap="goToSettings">
        <text>æé†’ä¸è®¢é˜…</text>
        <text class="arrow">â€º</text>
      </view>
      <view class="setting-item">
        <text>éšç§æ”¿ç­–</text>
        <text class="arrow">â€º</text>
      </view>
      <view class="setting-item">
        <text>å…³äºæˆ‘ä»¬</text>
        <text class="arrow">â€º</text>
      </view>
    </view>
  </view>
</view>

